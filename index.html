<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTAI Hub (Connected)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0",
        "@azure/msal-browser": "https://esm.sh/@azure/msal-browser@3.10.0",
        "@azure/msal-react": "https://esm.sh/@azure/msal-react@2.0.12?external=react,react-dom,@azure/msal-browser"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        /* Smooth fade in for elements */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* GTAI Colors Custom Classes */
        .bg-gtai-blue { background-color: #003B6E; }
        .text-gtai-blue { color: #003B6E; }
        .border-gtai-blue { border-color: #003B6E; }
        
        .bg-gtai-red { background-color: #E4002B; }
        .text-gtai-red { color: #E4002B; }
        .border-gtai-red { border-color: #E4002B; }
        
        .hover\:bg-gtai-red:hover { background-color: #c20024; }
        .hover\:bg-gtai-blue:hover { background-color: #002a50; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { PublicClientApplication } from "@azure/msal-browser";
        import { MsalProvider, useMsal, useIsAuthenticated } from "@azure/msal-react";
        import { 
            LayoutDashboard, LogOut, Globe, CheckCircle, Menu, X, Calendar, 
            MessageSquare, Zap, Newspaper, Bell, ListTodo, Plus, Trash2, 
            CheckSquare, Loader2, RefreshCw, Briefcase, Bot, ArrowRight,
            ExternalLink, FileText, MapPin, Video, Users, Clock, AlertTriangle, CalendarClock
        } from 'lucide-react';

        // --- 1. CONFIG ---
        const msalConfig = {
            auth: {
                clientId: "1bcff9d8-08fd-4807-9483-eeeab557d612",
                authority: "https://login.microsoftonline.com/7e77266e-8abb-4947-be1a-ce8f3bd5cb49",
                redirectUri: window.location.origin, 
            },
            cache: { cacheLocation: "sessionStorage" }
        };

        const loginRequest = {
            scopes: ["User.Read", "Calendars.ReadWrite", "Tasks.ReadWrite", "Sites.Read.All"] 
        };

        const msalInstance = new PublicClientApplication(msalConfig);
        if (!msalInstance.getActiveAccount() && msalInstance.getAllAccounts().length > 0) {
            msalInstance.setActiveAccount(msalInstance.getAllAccounts()[0]);
        }

        // --- HELPER: GRAPH API CALLER ---
        async function callMsGraph(instance, accounts, endpoint, method = "GET", body = null) {
            const request = {
                ...loginRequest,
                account: accounts[0]
            };

            try {
                const response = await instance.acquireTokenSilent(request);
                const headers = new Headers();
                const bearer = `Bearer ${response.accessToken}`;
                headers.append("Authorization", bearer);
                if (body) headers.append("Content-Type", "application/json");

                const options = {
                    method: method,
                    headers: headers,
                    body: body ? JSON.stringify(body) : null
                };

                const graphResponse = await fetch(`https://graph.microsoft.com/v1.0${endpoint}`, options);
                
                if (!graphResponse.ok) throw new Error(`Graph Error: ${graphResponse.statusText}`);
                
                const contentType = graphResponse.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    return await graphResponse.json();
                } else if (contentType && contentType.indexOf("image") !== -1) {
                    return await graphResponse.blob();
                }
                return await graphResponse.text();

            } catch (error) {
                console.error("Graph API Error:", error);
                throw error;
            }
        }

        // --- HAUPT APP ---
        const MainContent = () => {
            const { instance, accounts } = useMsal();
            const isAuthenticated = useIsAuthenticated();
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            
            // Echte Daten States
            const [userProfile, setUserProfile] = useState({ displayName: "", jobTitle: "", mail: "", photoUrl: null });
            const [calendarEvents, setCalendarEvents] = useState([]);
            const [plannerTasks, setPlannerTasks] = useState([]);
            const [isLoadingData, setIsLoadingData] = useState(false);

            // Intranet News State
            const [intranetNews, setIntranetNews] = useState([
                { id: 1, title: "Neue Reiserichtlinien ab 2025: Pauschalen angepasst", summary: "Wichtige Information f√ºr alle Reisenden nach Asien und USA.", date: "Heute, 08:30", category: "HR" },
                { id: 2, title: "Wartungsarbeiten am SharePoint-Server", summary: "Eingeschr√§nkte Verf√ºgbarkeit am kommenden Samstag.", date: "Gestern", category: "IT" },
                { id: 3, title: "R√ºckblick: Hannover Messe Erfolg", summary: "Besucherrekord am GTAI Stand. Vielen Dank an das Team!", date: "28.10.", category: "News" }
            ]);

            // Lokale States
            const [todos, setTodos] = useState([
                { id: 1, text: "Reisekostenabrechnung China fertigstellen", isBlocker: false, done: false },
            ]);
            const [newTodoText, setNewTodoText] = useState('');
            const [isBlocker, setIsBlocker] = useState(false);
            const [messages, setMessages] = useState([{ sender: 'bot', text: "Hallo! Ich bin Dexter. Ich habe Zugriff auf deine echten M365 Daten." }]);
            const [dexterInput, setDexterInput] = useState('');

            // --- INITIAL LOAD ---
            useEffect(() => {
                if (isAuthenticated && accounts[0]) {
                    loadAllData();
                }
            }, [isAuthenticated, accounts]);

            const loadAllData = async () => {
                setIsLoadingData(true);
                try {
                    // 1. Profil laden
                    const profile = await callMsGraph(instance, accounts, "/me");
                    let photoUrl = null;
                    try {
                        const photoBlob = await callMsGraph(instance, accounts, "/me/photo/$value");
                        photoUrl = URL.createObjectURL(photoBlob);
                    } catch (e) { console.log("Kein Profilbild gefunden"); }
                    
                    setUserProfile({ ...profile, photoUrl });

                    // 2. Kalender laden
                    const start = new Date().toISOString();
                    const end = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();
                    const calData = await callMsGraph(instance, accounts, `/me/calendarview?startDateTime=${start}&endDateTime=${end}&$top=10&$orderby=start/dateTime`);
                    setCalendarEvents(calData.value || []);

                    // 3. Planner Tasks laden
                    const taskData = await callMsGraph(instance, accounts, "/me/planner/tasks");
                    setPlannerTasks(taskData.value || []);

                } catch (e) {
                    console.error("Daten konnten nicht geladen werden", e);
                } finally {
                    setIsLoadingData(false);
                }
            };

            // --- REAL ACTION: WRITE TO CALENDAR ---
            const createCalendarBlocker = async (title) => {
                const start = new Date(); 
                const end = new Date(start.getTime() + 60 * 60 * 1000); 

                const event = {
                    subject: `üõ°Ô∏è FOKUS: ${title}`,
                    start: { dateTime: start.toISOString(), timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone },
                    end: { dateTime: end.toISOString(), timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone },
                    importance: "High"
                };

                try {
                    await callMsGraph(instance, accounts, "/me/events", "POST", event);
                    loadAllData(); // Refresh Calendar
                } catch (e) {
                    alert("Fehler beim Erstellen des Blockers: " + e.message);
                }
            };

            const handleAddTodo = (e) => {
                e.preventDefault();
                if (!newTodoText.trim()) return;
                const newTodo = { id: Date.now(), text: newTodoText, isBlocker };
                setTodos([...todos, newTodo]);
                
                if (isBlocker) {
                    createCalendarBlocker(newTodoText);
                }
                
                setNewTodoText('');
                setIsBlocker(false);
            };

            const getFirstName = () => userProfile.displayName ? userProfile.displayName.split(',')[1]?.trim() || userProfile.displayName.split(' ')[0] : "Gast";

            // --- RENDER LOGIN ---
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-100">
                        <div className="bg-white p-10 rounded-xl shadow-2xl text-center max-w-md w-full border-t-4 border-gtai-red">
                            <Globe className="w-16 h-16 text-gtai-blue mx-auto mb-4" />
                            <h1 className="text-2xl font-bold text-gtai-blue mb-2">GTAI Hub (Live Data)</h1>
                            <p className="text-sm text-gray-500 mb-6">Verbindet sich mit Ihrem echten Microsoft 365 Account.</p>
                            <div className="bg-blue-50 text-blue-800 text-xs p-2 rounded border border-blue-200 mb-6 break-all">
                                Redirect URI: {window.location.origin}
                            </div>
                            <button onClick={() => instance.loginPopup(loginRequest)} className="w-full bg-gtai-blue text-white p-3 rounded hover:bg-gtai-red transition flex justify-center items-center gap-2 font-medium shadow-lg">
                                <span>üîí</span> Mit Microsoft anmelden
                            </button>
                        </div>
                    </div>
                );
            }

            // --- RENDER DASHBOARD ---
            return (
                <div className="flex h-screen bg-slate-50 overflow-hidden">
                    {/* SIDEBAR */}
                    <aside className={`bg-gtai-blue text-white flex flex-col transition-all duration-300 ${isSidebarOpen ? 'w-64' : 'w-20'} z-20 shadow-2xl`}>
                        <div className="p-4 flex items-center justify-between border-b border-white/10">
                            {isSidebarOpen && <span className="font-bold flex items-center gap-2 tracking-wide"><Globe className="text-white" /> GTAI HUB</span>}
                            <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-1 hover:bg-white/10 rounded text-white"><Menu size={20} /></button>
                        </div>
                        <nav className="flex-1 py-4 space-y-1 px-2">
                            {[
                                { id: 'dashboard', icon: <LayoutDashboard />, label: 'Dashboard' },
                                { id: 'tasks', icon: <CheckCircle />, label: 'Planner & ToDo' },
                                { id: 'calendar', icon: <Calendar />, label: 'Kalender' },
                                { id: 'copilot', icon: <Bot />, label: 'Dexter Agent' }
                            ].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 p-3 rounded transition-all duration-200 ${activeTab === item.id ? 'bg-gtai-red shadow-md font-medium translate-x-1' : 'hover:bg-white/10 text-blue-100'} ${!isSidebarOpen && 'justify-center'}`}>
                                    {item.icon} {isSidebarOpen && <span>{item.label}</span>}
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-white/10 flex items-center gap-3 bg-black/10">
                            {userProfile.photoUrl ? (
                                <img src={userProfile.photoUrl} className="w-10 h-10 rounded-full border-2 border-white/30" />
                            ) : (
                                <div className="w-10 h-10 rounded-full bg-gtai-red flex items-center justify-center font-bold text-white border-2 border-white/20">{getFirstName().substring(0,2)}</div>
                            )}
                            {isSidebarOpen && <div className="overflow-hidden"><p className="text-sm font-bold truncate text-white">{getFirstName()}</p><button onClick={() => instance.logoutPopup()} className="text-xs text-blue-200 hover:text-white flex items-center gap-1 mt-0.5"><LogOut size={12} /> Logout</button></div>}
                        </div>
                    </aside>

                    {/* MAIN */}
                    <main className="flex-1 flex flex-col h-full bg-slate-50">
                        <header className="h-16 bg-white border-b flex items-center justify-between px-6 shadow-sm z-10">
                            <h2 className="text-xl font-bold capitalize text-gtai-blue flex items-center gap-2">
                                {activeTab === 'dashboard' && <LayoutDashboard size={22} />}
                                {activeTab === 'tasks' && <CheckCircle size={22} />}
                                {activeTab === 'calendar' && <Calendar size={22} />}
                                {activeTab === 'copilot' && <Bot size={22} />}
                                {activeTab}
                            </h2>
                            <div className="flex items-center gap-4">
                                <button onClick={loadAllData} className={`p-2 rounded-full hover:bg-slate-100 text-slate-500 ${isLoadingData && 'animate-spin text-gtai-blue'}`}><RefreshCw size={20}/></button>
                                <span className="text-sm text-gray-500 hidden md:inline border-l pl-4">{userProfile.jobTitle || "Mitarbeiter"}</span>
                            </div>
                        </header>

                        <div className="flex-1 overflow-auto p-6">
                            {activeTab === 'dashboard' && (
                                <div className="max-w-7xl mx-auto space-y-6 fade-in">
                                    {/* HERO BANNER - DEXTER */}
                                    <div className="bg-gradient-to-r from-gtai-blue to-[#00509e] rounded-2xl p-8 text-white relative overflow-hidden shadow-lg border-b-4 border-gtai-red">
                                        <div className="relative z-10 max-w-2xl">
                                            <h1 className="text-3xl font-bold mb-2">Hallo {getFirstName()}!</h1>
                                            <p className="mb-6 opacity-90 text-blue-100">Was kann ich heute f√ºr dich tun?</p>
                                            <form onSubmit={(e) => { e.preventDefault(); setActiveTab('copilot'); setMessages(p => [...p, {sender:'user', text: dexterInput}]); }} className="flex gap-2 shadow-xl rounded-lg">
                                                <div className="relative flex-1">
                                                    <Bot className="absolute left-3 top-3.5 text-gtai-blue" size={20} />
                                                    <input value={dexterInput} onChange={e => setDexterInput(e.target.value)} placeholder="Frag Dexter etwas..." className="w-full pl-10 pr-4 py-3.5 rounded-l-lg text-slate-900 outline-none" />
                                                </div>
                                                <button className="bg-gtai-red text-white px-6 rounded-r-lg font-bold hover:bg-[#c20024] transition flex items-center gap-2">Go <ArrowRight size={18} /></button>
                                            </form>
                                        </div>
                                        <Bot size={180} className="absolute -right-8 -bottom-8 opacity-10 rotate-12" />
                                    </div>

                                    {/* 2-COLUMN GRID LAYOUT */}
                                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
                                        
                                        {/* 1. KALENDER CARD */}
                                        <div onClick={() => setActiveTab('calendar')} className="bg-white p-0 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex flex-col h-full group overflow-hidden">
                                            <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                                <h3 className="font-bold flex gap-2 text-lg items-center text-slate-800 group-hover:text-gtai-blue transition"><Calendar className="text-gtai-blue" /> N√§chste Termine</h3>
                                                <span className="text-xs bg-white border border-green-200 text-green-700 px-2 py-1 rounded shadow-sm">Live Outlook</span>
                                            </div>
                                            <div className="p-5 space-y-4 flex-1">
                                                {calendarEvents.length === 0 ? <p className="text-gray-400 text-sm italic">Keine Termine f√ºr heute gefunden.</p> : 
                                                 calendarEvents.slice(0, 4).map(evt => (
                                                    <div key={evt.id} className="flex gap-4 items-start pb-3 border-b last:border-0 border-slate-50 group-hover:border-slate-100 transition">
                                                        <div className="font-bold text-slate-500 w-14 text-right pt-0.5 shrink-0 text-sm font-mono">
                                                            {new Date(evt.start.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                                        </div>
                                                        <div className="border-l-4 border-gtai-blue pl-3 flex-1 min-w-0">
                                                            <div className="font-semibold text-slate-800 text-sm leading-tight break-words">{evt.subject}</div>
                                                            <div className="text-xs text-gray-500 mt-1.5 flex items-center gap-1.5">
                                                                <Video size={12} className="text-gtai-red" /> {evt.location?.displayName || "Online Meeting"}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* 2. PLANNER (TEAM) CARD */}
                                        <div onClick={() => setActiveTab('tasks')} className="bg-white p-0 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex flex-col h-full group overflow-hidden">
                                            <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                                <h3 className="font-bold flex gap-2 text-lg items-center text-slate-800 group-hover:text-gtai-blue transition"><CheckCircle className="text-gtai-blue" /> Team-Aufgaben</h3>
                                                <span className="text-xs bg-white border border-blue-200 text-blue-700 px-2 py-1 rounded shadow-sm">Live Planner</span>
                                            </div>
                                            <div className="p-5 space-y-3 flex-1">
                                                {plannerTasks.length === 0 ? <p className="text-gray-400 text-sm italic">Keine zugewiesenen Aufgaben im Planner.</p> : 
                                                 plannerTasks.slice(0, 4).map(task => (
                                                    <div key={task.id} className="p-3 bg-slate-50 rounded-lg border border-slate-100 flex justify-between items-start gap-3 hover:bg-white hover:border-blue-200 transition hover:shadow-sm">
                                                        <div className="flex-1 min-w-0">
                                                            <span className="text-sm font-medium text-slate-800 break-words block mb-1">{task.title}</span>
                                                            <span className="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Projekt Alpha</span>
                                                        </div>
                                                        {task.dueDateTime && <span className="text-xs font-bold text-gtai-red bg-red-50 px-2 py-1 rounded shrink-0 flex items-center gap-1"><Clock size={10}/> {new Date(task.dueDateTime).toLocaleDateString()}</span>}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* 3. TO-DO (PRIVAT) CARD */}
                                        <div onClick={() => setActiveTab('tasks')} className="bg-white p-0 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex flex-col h-full group overflow-hidden">
                                            <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                                <h3 className="font-bold flex gap-2 text-lg items-center text-slate-800 group-hover:text-gtai-blue transition"><ListTodo className="text-gtai-blue" /> Meine Fokus-Liste</h3>
                                                <span className="text-xs bg-white border border-slate-200 text-slate-600 px-2 py-1 rounded shadow-sm">Privat</span>
                                            </div>
                                            <ul className="p-5 space-y-2 flex-1">
                                                {todos.map(t => (
                                                    <li key={t.id} className="flex items-center gap-3 p-2 hover:bg-slate-50 rounded border border-transparent hover:border-slate-100 transition">
                                                        <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${t.isBlocker ? 'border-gtai-red' : 'border-slate-300'}`}>
                                                            {t.isBlocker && <div className="w-2.5 h-2.5 bg-gtai-red rounded-full"></div>}
                                                        </div>
                                                        <span className="text-sm text-slate-700 break-words flex-1 leading-snug">{t.text}</span>
                                                    </li>
                                                ))}
                                                {todos.length === 0 && <li className="text-gray-400 text-sm italic">Liste leer.</li>}
                                            </ul>
                                            <div className="px-5 pb-5 pt-2 border-t border-slate-50">
                                                <span className="text-xs text-gtai-blue font-bold flex items-center gap-1 group-hover:underline"><Plus size={14} /> Aufgabe hinzuf√ºgen</span>
                                            </div>
                                        </div>

                                        {/* 4. INTRANET NEWS CARD */}
                                        <div className="bg-white p-0 rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                            <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                                <h3 className="font-bold flex gap-2 text-lg items-center text-slate-800"><Globe className="text-gtai-blue" /> Intranet News</h3>
                                                <a href="https://gtai.sharepoint.com/sites/GTAI-Intranet" target="_blank" className="text-xs text-gtai-blue hover:underline flex items-center gap-1 font-medium">Zum Intranet <ExternalLink size={12} /></a>
                                            </div>
                                            <div className="p-5 space-y-4">
                                                {intranetNews.map(news => (
                                                    <a key={news.id} href="#" className="block group/news relative pl-4">
                                                        <div className="absolute left-0 top-1 bottom-1 w-1 bg-gtai-blue/20 group-hover/news:bg-gtai-red transition rounded-full"></div>
                                                        <div className="flex justify-between text-xs text-slate-400 mb-1">
                                                            <span>{news.date}</span>
                                                            <span className="uppercase font-bold tracking-wide text-gtai-blue text-[10px] bg-blue-50 px-1.5 py-0.5 rounded">{news.category}</span>
                                                        </div>
                                                        <h4 className="font-bold text-slate-800 text-sm group-hover/news:text-gtai-blue transition break-words">{news.title}</h4>
                                                        <p className="text-xs text-slate-500 mt-1 line-clamp-1">{news.summary}</p>
                                                    </a>
                                                ))}
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            )}

                            {/* TASKS VIEW (Merged Planner + ToDo) */}
                            {activeTab === 'tasks' && (
                                <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 fade-in">
                                    {/* Left: Planner */}
                                    <div className="bg-white p-8 rounded-xl shadow border border-slate-200 h-full">
                                        <h2 className="text-xl font-bold mb-6 flex gap-2 items-center text-gtai-blue"><CheckCircle /> Planner (Team)</h2>
                                        {isTasksLoading ? <Loader2 className="animate-spin mx-auto text-slate-400" /> : (
                                            <div className="space-y-4">
                                                {plannerTasks.length === 0 ? <p className="text-slate-400">Keine Aufgaben.</p> : plannerTasks.map(task => (
                                                    <div key={task.id} className="p-4 rounded-lg border border-slate-100 hover:border-blue-200 transition bg-slate-50 hover:bg-white">
                                                        <div className="flex justify-between items-start gap-4">
                                                            <div className="flex-1">
                                                                <h4 className="font-semibold text-slate-800 break-words">{task.title}</h4>
                                                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded mt-2 inline-block">Projekt Alpha</span>
                                                            </div>
                                                            {task.priority < 5 && <AlertTriangle size={18} className="text-gtai-red shrink-0" title="Hohe Priorit√§t" />}
                                                        </div>
                                                        {task.dueDateTime && <div className="mt-3 flex items-center gap-1 text-xs text-slate-500"><Clock size={12}/> F√§llig: {new Date(task.dueDateTime).toLocaleDateString()}</div>}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Right: Personal To-Do */}
                                    <div className="bg-white p-8 rounded-xl shadow border border-slate-200 h-full">
                                        <h2 className="text-xl font-bold mb-6 flex gap-2 items-center text-gtai-blue"><ListTodo /> Privat (Fokus)</h2>
                                        
                                        <form onSubmit={handleAddTodo} className="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6 shadow-inner">
                                            <input value={newTodoText} onChange={e=>setNewTodoText(e.target.value)} placeholder="Neue Aufgabe..." className="w-full p-2 mb-3 rounded border border-slate-300 outline-none focus:ring-2 focus:ring-gtai-blue" />
                                            <div className="flex justify-between items-center">
                                                <label className="flex items-center gap-2 text-sm cursor-pointer select-none">
                                                    <input type="checkbox" checked={isBlocker} onChange={e=>setIsBlocker(e.target.checked)} className="rounded text-gtai-blue focus:ring-gtai-blue" />
                                                    <span className={isBlocker ? "font-bold text-gtai-red" : "text-slate-600"}>Als Blocker eintragen</span>
                                                </label>
                                                <button className="bg-gtai-blue text-white px-3 py-1.5 rounded text-sm hover:bg-gtai-red transition shadow-sm flex items-center gap-1"><Plus size={16} /> Add</button>
                                            </div>
                                        </form>

                                        <div className="space-y-2">
                                            {todos.map(t => (
                                                <div key={t.id} className="flex justify-between p-3 border rounded-lg items-center bg-white hover:border-slate-300 transition shadow-sm">
                                                    <span className="text-sm font-medium break-words flex-1 pr-4 text-slate-700">{t.text} {t.isBlocker && <span className="text-gtai-red ml-1 inline-flex items-center bg-red-50 px-1.5 py-0.5 rounded text-[10px]" title="Kalender Blocker">üõ°Ô∏è BLOCKER</span>}</span>
                                                    <button onClick={() => setTodos(todos.filter(x=>x.id !== t.id))} className="text-slate-300 hover:text-gtai-red transition"><Trash2 size={16}/></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Weitere Tabs hier gek√ºrzt f√ºr √úbersichtlichkeit - Logik bleibt erhalten */}
                            {activeTab === 'copilot' && (
                                <div className="h-full flex flex-col bg-white rounded-xl shadow border border-slate-200 overflow-hidden fade-in">
                                    <div className="p-4 bg-slate-50 border-b flex gap-3 items-center"><Bot className="text-gtai-blue" /><h3 className="font-bold text-gtai-blue">Dexter (GTAI Agent)</h3></div>
                                    <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                        {messages.map((m, i) => (
                                            <div key={i} className={`mb-4 p-4 rounded-xl max-w-[80%] shadow-sm ${m.sender === 'user' ? 'ml-auto bg-gtai-blue text-white rounded-tr-none' : 'bg-white border border-slate-200 rounded-tl-none'}`}>
                                                <strong className="text-xs opacity-70 block mb-1">{m.sender === 'user' ? getFirstName() : 'Dexter'}</strong>
                                                {m.text}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<MsalProvider instance={msalInstance}><MainContent /></MsalProvider>);
    </script>
</body>
</html>
